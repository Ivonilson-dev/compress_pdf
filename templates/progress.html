<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprimindo PDF - Em andamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        .progress-container {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .progress {
            height: 25px;
            margin-bottom: 20px;
        }

        .progress-bar {
            transition: width 0.5s ease;
        }

        .status-message {
            text-align: center;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .file-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="progress-container">
        <h2 class="text-center mb-4">Comprimindo PDF</h2>

        <div class="file-info">
            <p><strong>Arquivo:</strong> {{ original_name }}</p>
            <p><strong>Perfil:</strong> {{ profile_name }}</p>
        </div>

        <div class="progress">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                style="width: 0%"></div>
        </div>

        <div id="statusMessage" class="status-message">
            Preparando compress√£o...
        </div>

        <div id="resultSection" style="display: none;">
            <div class="alert alert-success text-center">
                <h4>Compress√£o Conclu√≠da!</h4>
                <p id="resultMessage"></p>
                <div class="mt-3">
                    <a id="downloadBtn" href="#" class="btn btn-success btn-lg">
                        üì• Baixar PDF Comprimido
                    </a>
                    <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg ms-2">
                        üîÑ Comprimir Outro PDF
                    </a>
                </div>
            </div>
        </div>

        <div id="errorSection" style="display: none;">
            <div class="alert alert-danger text-center">
                <h4>Erro na Compress√£o</h4>
                <p id="errorMessage"></p>
                <div class="mt-3">
                    <a href="{{ url_for('index') }}" class="btn btn-warning btn-lg">
                        ‚Ü©Ô∏è Voltar e Tentar Novamente
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sessionId = "{{ session_id }}";
        let checkInterval;

        function updateProgress() {
            fetch(`/progress/${sessionId}`)
                .then(response => response.json())
                .then(data => {
                    const progressBar = document.getElementById('progressBar');
                    const statusMessage = document.getElementById('statusMessage');

                    progressBar.style.width = `${data.percentage}%`;
                    progressBar.textContent = `${data.percentage}%`;
                    statusMessage.textContent = `${data.stage}: ${data.message}`;

                    <!-- Na se√ß√£o do JavaScript, atualize esta parte: -->
                    if (data.complete) {
                        clearInterval(checkInterval);

                        if (data.error) {
                            // Mostra erro
                            document.getElementById('errorMessage').textContent = data.error;
                            document.getElementById('errorSection').style.display = 'block';
                            document.getElementById('progressBar').classList.remove('progress-bar-animated');
                            document.getElementById('progressBar').classList.add('bg-danger');
                        } else if (data.result) {
                            // Redireciona para a p√°gina de resultado
                            setTimeout(function () {
                                window.location.href = `/compress_result/${sessionId}?profile_name=${encodeURIComponent("{{ profile_name }}")}`;
                            }, 1500); // Pequeno delay para mostrar 100%
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro ao verificar progresso:', error);
                });
        }

        // Verifica o progresso a cada segundo
        checkInterval = setInterval(updateProgress, 1000);

        // Primeira verifica√ß√£o imediata
        updateProgress();
    </script>
</body>

</html>